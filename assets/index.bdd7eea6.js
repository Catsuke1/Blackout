var Be=Object.defineProperty;var Ie=(s,e,n)=>e in s?Be(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var y=(s,e,n)=>(Ie(s,typeof e!="symbol"?e+"":e,n),n);import{P as Pe,w as se,S as O,i as $,s as z,e as v,a as A,t as E,b,c as C,d as x,n as I,f as w,g as G,h as N,m as M,j as q,k as B,l as R,o as P,p as V,q as ue,r as Y,u as J,v as fe,x as he,y as ie,z as Ae,A as X,B as Ee,C as de,D as De,E as pe,F as ne,G as Z,H as oe,I as We,J as me,K as He,L as Ge}from"./vendor.dff4c89e.js";const Oe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}};Oe();function ge(s,e){for(let n=0;n<s.length;n++)for(let o=0;o<s[n].length;o++)e(s[n][o],n,o)}function _e(s,e,n){const o=new Array(s);for(let t=0;t<s;t++){o[t]=new Array(e);for(let i=0;i<e;i++)o[t][i]=n}return o}class re{constructor(e,n){this.row=e,this.column=n}static isEqual(e,n){return e.row===n.row&&e.column===n.column}}function L(s,e){return new re(s,e)}var T;(function(s){s[s.Empty=0]="Empty",s[s.WhitePiece=1]="WhitePiece",s[s.BlackPiece=2]="BlackPiece",s[s.Card=3]="Card"})(T||(T={}));class $e{constructor(e,n){y(this,"rows");y(this,"columns");y(this,"squareTypes");this.rows=e,this.columns=n,this.squareTypes=_e(e,n,T.Empty)}getTypeAt(e){return this.squareTypes[e.row][e.column]}setSquareType(e,n){this.squareTypes[e.row][e.column]=n}forEachSquareType(e){ge(this.squareTypes,(n,o,t)=>{e(n,L(o,t))})}movePiece(e,n){this.setSquareType(n,this.getTypeAt(e)),this.setSquareType(e,T.Empty)}getQueenPositions(){const e={white:[],black:[]};return this.forEachSquareType((n,o)=>{n===T.WhitePiece?e.white.push(o):n===T.BlackPiece&&e.black.push(o)}),e}}function ze(s,e){for(const n of e)if(s.row===n.row&&s.column===n.column)return!0;return!1}function le(s,e){const n=[];for(let o=e.row-1;o>-1;o--){const t=L(o,e.column);if(s.getTypeAt(t)!==T.Empty)break;n.push(t)}for(let o=e.row+1;o<s.rows;o++){const t=L(o,e.column);if(s.getTypeAt(t)!==T.Empty)break;n.push(t)}for(let o=e.column-1;o>-1;o--){const t=L(e.row,o);if(s.getTypeAt(t)!==T.Empty)break;n.push(t)}for(let o=e.column+1;o<s.columns;o++){const t=L(e.row,o);if(s.getTypeAt(t)!==T.Empty)break;n.push(t)}for(let o=e.row-1,t=e.column-1;o>-1&&t>-1;o--,t--){const i=L(o,t);if(s.getTypeAt(i)!==T.Empty)break;n.push(i)}for(let o=e.row-1,t=e.column+1;o>-1&&t<s.columns;o--,t++){const i=L(o,t);if(s.getTypeAt(i)!==T.Empty)break;n.push(i)}for(let o=e.row+1,t=e.column-1;o<s.rows&&t>-1;o++,t--){const i=L(o,t);if(s.getTypeAt(i)!==T.Empty)break;n.push(i)}for(let o=e.row+1,t=e.column+1;o<s.rows&&t<s.columns;o++,t++){const i=L(o,t);if(s.getTypeAt(i)!==T.Empty)break;n.push(i)}return n}var D;(function(s){s[s.White=0]="White",s[s.Black=1]="Black"})(D||(D={}));var F;(function(s){s[s.Piece=0]="Piece",s[s.Card=1]="Card"})(F||(F={}));class Le{constructor(e){y(this,"gameSettings");y(this,"boardData");y(this,"turn",{color:void 0,action:void 0});y(this,"winner");this.gameSettings=e,this.reset()}get(){return{board:this.boardData.squareTypes,turn:this.turn}}set(e){this.boardData.squareTypes=e.board,this.turn=e.turn,this.winner=this.getWinner()}reset(){this.boardData=new $e(this.gameSettings.rows,this.gameSettings.columns);for(const e of this.gameSettings.start.pieces.white)this.boardData.setSquareType(e,T.WhitePiece);for(const e of this.gameSettings.start.pieces.black)this.boardData.setSquareType(e,T.BlackPiece);this.turn.color=this.gameSettings.start.color,this.turn.action=this.gameSettings.start.action,this.winner=this.getWinner()}nextTurn(){this.turn.color=this.turn.color===1?0:1,this.turn.color===this.gameSettings.start.color&&(this.turn.action=this.turn.action===1?0:1),this.winner=this.getWinner()}getWinner(){const e=this.boardData.getQueenPositions();let n=!0,o=!0;for(const t of e.white)if(le(this.boardData,t).length!==0){n=!1;break}for(const t of e.black)if(le(this.boardData,t).length!==0){o=!1;break}return n&&o?this.turn.color===0?1:0:n?1:o?0:null}}var K;(function(s){s[s.Me=0]="Me",s[s.Them=1]="Them"})(K||(K={}));class xe{constructor(){y(this,"connectionId");y(this,"connected");y(this,"myColor");y(this,"playerNumber");y(this,"newGameRequest");y(this,"scoreboard");this.connectionId=void 0,this.connected=!1,this.myColor=void 0,this.newGameRequest=void 0,this.scoreboard=[0,0]}setupConnection(e,n){this.connectionId=e.id,this.connected=!0,this.myColor=n,this.scoreboard=[0,0]}closeConnection(){this.connectionId=void 0,this.connected=!1,this.myColor=void 0,this.newGameRequest=void 0,this.scoreboard=[0,0]}requestNewGame(e){return console.log("new game request by",e),this.newGameRequest===void 0?(this.newGameRequest=e,!1):e!==this.newGameRequest?(this.newGameRequest=void 0,!0):!1}setWinner(e){e===0?this.scoreboard[0]++:this.scoreboard[1]++}swapColors(){this.myColor===D.Black?this.myColor=D.White:this.myColor=D.Black}}function Ne(s,e,n,o,t,i){return{rows:s,columns:e,start:{pieces:{white:n.map(r=>L(r[0],r[1])),black:o.map(r=>L(r[0],r[1]))},color:t,action:i}}}class Me{constructor(e){y(this,"dataConnection");y(this,"id");y(this,"metadata");y(this,"label");y(this,"reliable");this.dataConnection=e,this.id=this.dataConnection.peer,this.metadata=this.dataConnection.metadata,this.label=this.dataConnection.label,this.reliable=this.dataConnection.reliable}async open(){return await new Promise((e,n)=>{this.dataConnection.on("open",()=>{e()}),this.dataConnection.on("error",o=>{n(o)})})}getDataConnection(){return this.dataConnection}isOpen(){return this.dataConnection.open}close(){this.dataConnection.close()}send(e){this.dataConnection.send(e)}}class Re{constructor(){y(this,"connections");this.connections={}}add(e){this.connections[e.id]=e}remove(e){delete this.connections[e.id]}get(e){return this.connections[e]}getAll(){return Object.values(this.connections)}removeAll(){this.connections={}}count(){return Object.values(this.connections).length}}class Qe{constructor(e){y(this,"me");y(this,"list");y(this,"recievers");this.me=e,this.list=new Re,this.recievers=[]}setupDataConnection(e){e.getDataConnection().on("data",n=>{for(const o of this.recievers)o(n,e.id)}),e.getDataConnection().on("close",()=>{this.list.remove(e),this.closeConnection(e.id)}),e.getDataConnection().on("error",n=>{this.list.remove(e),this.closeConnection(e.id)})}async addConnection(e){const n=new Me(e);return await n.open(),this.setupDataConnection(n),this.list.add(n),n}async connect(e,n){const o=this.me.connect(e,n);return await this.addConnection(o)}disconnect(e){const n=this.list.get(e);n.close(),this.list.remove(n)}disconnectAll(){this.list.getAll().forEach(e=>{e.close()}),this.list.removeAll()}send(e,...n){n.forEach(o=>{const t=this.list.get(o);t!==void 0&&(t.isOpen()?t.send(e):this.list.remove(t))})}sendAll(e){this.list.getAll().forEach(n=>{n.isOpen()?n.send(e):this.list.remove(n)})}closeConnection(e){}}class je{constructor(e){y(this,"me");y(this,"options");y(this,"connectionClient");y(this,"id");y(this,"openTriggers");this.options=e,this.openTriggers=[]}async open(){return this.me=new Pe(void 0,this.options),this.connectionClient=new Qe(this.me),this.me.on("close",()=>{this.connectionClient.disconnectAll()}),this.me.on("disconnected",()=>{this.id=void 0}),this.me.on("error",e=>{this.id=void 0,this.connectionClient.disconnectAll()}),this.me.on("connection",async e=>{const n=await this.connectionClient.addConnection(e);this.remoteConnection(n)}),await new Promise((e,n)=>{this.me.on("open",o=>{this.id=o;for(const t of this.openTriggers)t();e(o)})})}getPeer(){return this.me}disconnect(){this.me.disconnect()}destroy(){this.me.destroy()}isDisconnected(){return this.me.disconnected}isDestroyed(){return this.me.destroyed}remoteConnection(e){}}const Ve=Ne(8,8,[[0,2],[0,4]],[[7,3],[7,5]],D.White,F.Piece),Q=se(new Le(Ve)),ee=se(new je),H=se(new xe);function Fe(s){let e,n,o,t,i,r=s[0].scoreboard[0]+"",c,l,a,m,f=s[0].scoreboard[1]+"",_;return{c(){e=v("div"),n=v("p"),n.textContent="Score",o=A(),t=v("p"),i=E("You: "),c=E(r),l=A(),a=v("p"),m=E("Opponent: "),_=E(f)},m(g,p){b(g,e,p),C(e,n),C(e,o),C(e,t),C(t,i),C(t,c),C(e,l),C(e,a),C(a,m),C(a,_)},p(g,[p]){p&1&&r!==(r=g[0].scoreboard[0]+"")&&x(c,r),p&1&&f!==(f=g[0].scoreboard[1]+"")&&x(_,f)},i:I,o:I,d(g){g&&w(e)}}}function Ke(s,e,n){let o;return G(s,H,t=>n(0,o=t)),[o]}class Ue extends O{constructor(e){super();$(this,e,Ke,Fe,z,{})}}function be(s){let e,n,o;return{c(){e=v("p"),n=E(s[1]),o=E(" (1/2)")},m(t,i){b(t,e,i),C(e,n),C(e,o)},p(t,i){i&2&&x(n,t[1])},d(t){t&&w(e)}}}function Ye(s){let e,n,o=s[0].connectionId+"",t,i,r,c,l=(s[0].myColor===D.White?"white":"black")+"",a,m,f,_,g,p,d=s[2]&&be(s);return g=new Ue({}),{c(){e=v("p"),n=E("Connected to "),t=E(o),i=A(),r=v("p"),c=E("You are "),a=E(l),m=E("."),f=A(),d&&d.c(),_=A(),N(g.$$.fragment)},m(u,h){b(u,e,h),C(e,n),C(e,t),b(u,i,h),b(u,r,h),C(r,c),C(r,a),C(r,m),b(u,f,h),d&&d.m(u,h),b(u,_,h),M(g,u,h),p=!0},p(u,[h]){(!p||h&1)&&o!==(o=u[0].connectionId+"")&&x(t,o),(!p||h&1)&&l!==(l=(u[0].myColor===D.White?"white":"black")+"")&&x(a,l),u[2]?d?d.p(u,h):(d=be(u),d.c(),d.m(_.parentNode,_)):d&&(d.d(1),d=null)},i(u){p||(q(g.$$.fragment,u),p=!0)},o(u){B(g.$$.fragment,u),p=!1},d(u){u&&w(e),u&&w(i),u&&w(r),u&&w(f),d&&d.d(u),u&&w(_),R(g,u)}}}function Je(s,e,n){let o,t,i;return G(s,H,r=>n(0,i=r)),s.$$.update=()=>{s.$$.dirty&1&&n(2,o=i.newGameRequest!==void 0),s.$$.dirty&1&&n(1,t=(()=>i.newGameRequest===K.Me?"Requesting a new game":i.newGameRequest===K.Them?"Opponent is requesting a new game":"")())},[i,t,o]}class Xe extends O{constructor(e){super();$(this,e,Je,Ye,z,{})}}function Ze(s){let e,n,o,t;return{c(){e=v("button"),n=E(s[0]),P(e,"type","button")},m(i,r){b(i,e,r),C(e,n),o||(t=V(e,"click",s[1]),o=!0)},p(i,[r]){r&1&&x(n,i[0])},i:I,o:I,d(i){i&&w(e),o=!1,t()}}}function et(s,e,n){let o,{text:t=["off","on"]}=e,{isOn:i=!1}=e;const r=ue(),c=()=>{n(2,i=!i),r("toggle",i)};return s.$$set=l=>{"text"in l&&n(3,t=l.text),"isOn"in l&&n(2,i=l.isOn)},s.$$.update=()=>{s.$$.dirty&12&&n(0,o=i?t[1]:t[0])},[o,c,i,t]}class tt extends O{constructor(e){super();$(this,e,et,Ze,z,{text:3,isOn:2})}}function nt(s){let e,n,o,t;return{c(){e=E(`Want to play with somebody?
    `),n=v("button"),n.textContent="Create a peer",P(n,"type","button")},m(i,r){b(i,e,r),b(i,n,r),o||(t=V(n,"click",s[5]),o=!0)},p:I,i:I,o:I,d(i){i&&w(e),i&&w(n),o=!1,t()}}}function ot(s){let e,n,o,t={ctx:s,current:null,token:null,hasCatch:!1,pending:ct,then:it,catch:st,value:13,blocks:[,,,]};return he(n=s[1],t),{c(){e=ie(),t.block.c()},m(i,r){b(i,e,r),t.block.m(i,t.anchor=r),t.mount=()=>e.parentNode,t.anchor=e,o=!0},p(i,r){s=i,t.ctx=s,r&2&&n!==(n=s[1])&&he(n,t)||Ae(t,s,r)},i(i){o||(q(t.block),o=!0)},o(i){for(let r=0;r<3;r+=1){const c=t.blocks[r];B(c)}o=!1},d(i){i&&w(e),t.block.d(i),t.token=null,t=null}}}function st(s){return{c:I,m:I,p:I,i:I,o:I,d:I}}function it(s){let e,n,o,t;const i=[lt,rt],r=[];function c(l,a){return l[4].connected?0:1}return e=c(s),n=r[e]=i[e](s),{c(){n.c(),o=ie()},m(l,a){r[e].m(l,a),b(l,o,a),t=!0},p(l,a){let m=e;e=c(l),e===m?r[e].p(l,a):(Y(),B(r[m],1,1,()=>{r[m]=null}),J(),n=r[e],n?n.p(l,a):(n=r[e]=i[e](l),n.c()),q(n,1),n.m(o.parentNode,o))},i(l){t||(q(n),t=!0)},o(l){B(n),t=!1},d(l){r[e].d(l),l&&w(o)}}}function rt(s){let e,n,o,t=s[13]+"",i,r,c,l,a,m,f,_,g,p,d,u,h,S,j;function U(k){s[9](k)}let ce={text:["White","Black"]};return s[3]!==void 0&&(ce.isOn=s[3]),g=new tt({props:ce}),X.push(()=>Ee(g,"isOn",U)),{c(){e=v("p"),e.textContent="Created peer with id:",n=A(),o=v("pre"),i=E(t),r=A(),c=v("label"),c.textContent="Connection ID",l=A(),a=v("input"),m=A(),f=v("div"),_=E(`Choose a color

          `),N(g.$$.fragment),d=A(),u=v("button"),u.textContent="Connect",P(c,"for","connectionId"),P(a,"type","text"),P(a,"id","connectionId"),P(u,"type","button")},m(k,W){b(k,e,W),b(k,n,W),b(k,o,W),C(o,i),b(k,r,W),b(k,c,W),b(k,l,W),b(k,a,W),de(a,s[2]),b(k,m,W),b(k,f,W),C(f,_),M(g,f,null),b(k,d,W),b(k,u,W),h=!0,S||(j=[V(a,"input",s[8]),V(u,"click",s[6])],S=!0)},p(k,W){(!h||W&2)&&t!==(t=k[13]+"")&&x(i,t),W&4&&a.value!==k[2]&&de(a,k[2]);const ae={};!p&&W&8&&(p=!0,ae.isOn=k[3],De(()=>p=!1)),g.$set(ae)},i(k){h||(q(g.$$.fragment,k),h=!0)},o(k){B(g.$$.fragment,k),h=!1},d(k){k&&w(e),k&&w(n),k&&w(o),k&&w(r),k&&w(c),k&&w(l),k&&w(a),k&&w(m),k&&w(f),R(g),k&&w(d),k&&w(u),S=!1,pe(j)}}}function lt(s){let e,n,o,t,i,r;return e=new Xe({}),{c(){N(e.$$.fragment),n=A(),o=v("button"),o.textContent="Disconnect",P(o,"type","button")},m(c,l){M(e,c,l),b(c,n,l),b(c,o,l),t=!0,i||(r=V(o,"click",s[7]),i=!0)},p:I,i(c){t||(q(e.$$.fragment,c),t=!0)},o(c){B(e.$$.fragment,c),t=!1},d(c){R(e,c),c&&w(n),c&&w(o),i=!1,r()}}}function ct(s){let e;return{c(){e=v("p"),e.textContent="Creating peer..."},m(n,o){b(n,e,o)},p:I,i:I,o:I,d(n){n&&w(e)}}}function at(s){let e,n,o,t;const i=[ot,nt],r=[];function c(l,a){return l[0]?0:1}return n=c(s),o=r[n]=i[n](s),{c(){e=v("div"),o.c(),P(e,"class","panelContainer svelte-1wa81jg")},m(l,a){b(l,e,a),r[n].m(e,null),t=!0},p(l,[a]){let m=n;n=c(l),n===m?r[n].p(l,a):(Y(),B(r[m],1,1,()=>{r[m]=null}),J(),o=r[n],o?o.p(l,a):(o=r[n]=i[n](l),o.c()),q(o,1),o.m(e,null))},i(l){t||(q(o),t=!0)},o(l){B(o),t=!1},d(l){l&&w(e),r[n].d()}}}function ut(s,e,n){let o,t,i;G(s,H,u=>n(4,o=u)),G(s,ee,u=>n(11,t=u)),G(s,Q,u=>n(12,i=u));let r=!1,c;const l=async()=>{n(0,r=!0),n(1,c=t.open())};let a="",m,f=!1;t.openTriggers.push(()=>{fe(ee,t.remoteConnection=u=>{},t),fe(ee,t.connectionClient.closeConnection=u=>{u===o.connectionId&&H.update(h=>(h.closeConnection(),h))},t),t.connectionClient.recievers.push((u,h)=>{if(o.connected&&o.connectionId!==h){t.connectionClient.send({type:"textInfo",data:"This peer is already connected to somebody else!"},h),t.connectionClient.list.get(h).close();return}if((u==null?void 0:u.type)==="setup"){const S=t.connectionClient.list.get(h),j=u.data.color===D.White?D.Black:D.White;H.update(U=>(U.setupConnection(S,j),U)),Q.update(U=>(U.set(u.data.gameData),U))}})});const _=async()=>{try{m=await t.connectionClient.connect(a,{reliable:!0})}catch{console.log("failed to connect!");return}const u=f?D.Black:D.White;H.update(h=>(h.setupConnection(m,u),h)),Q.update(h=>(h.reset(),h)),t.connectionClient.send({type:"setup",data:{gameData:i.get(),color:u}},o.connectionId)},g=()=>{t.connectionClient.disconnect(o.connectionId),H.update(u=>(u.closeConnection(),u))};function p(){a=this.value,n(2,a)}function d(u){f=u,n(3,f)}return[r,c,a,f,o,l,_,g,p,d]}class ft extends O{constructor(e){super();$(this,e,ut,at,z,{})}}function ht(s){let e,n,o,t;return{c(){e=v("div"),n=E(s[2]),P(e,"class","square svelte-1tz948c"),ne(e,"--squareSize",s[1]+"rem"),Z(e,"black",s[0].isBlack),Z(e,"highlight",s[3]),Z(e,"card",s[4])},m(i,r){b(i,e,r),C(e,n),o||(t=V(e,"click",s[5]),o=!0)},p(i,[r]){r&4&&x(n,i[2]),r&2&&ne(e,"--squareSize",i[1]+"rem"),r&1&&Z(e,"black",i[0].isBlack),r&8&&Z(e,"highlight",i[3]),r&16&&Z(e,"card",i[4])},i:I,o:I,d(i){i&&w(e),o=!1,t()}}}function dt(s,e,n){let o,t;G(s,Q,p=>n(8,t=p));let{squareData:i}=e,{squareSize:r=5}=e,c="",l=!1,a=!1;const m=p=>{n(3,l=p)},f=p=>{switch(n(4,a=p===T.Card),p){case T.Empty:case T.Card:n(2,c="");break;case T.WhitePiece:n(2,c="\u2655");break;case T.BlackPiece:n(2,c="\u265B");break}return p},_=ue(),g=()=>{_("square-click",{position:L(i.row,i.column),squareType:o})};return s.$$set=p=>{"squareData"in p&&n(0,i=p.squareData),"squareSize"in p&&n(1,r=p.squareSize)},s.$$.update=()=>{s.$$.dirty&257&&(o=f(t.boardData.squareTypes[i.row][i.column]))},[i,r,c,l,a,g,m,f,t]}class pt extends O{constructor(e){super();$(this,e,dt,ht,z,{squareData:0,squareSize:1,setHighlight:6,setType:7})}get setHighlight(){return this.$$.ctx[6]}get setType(){return this.$$.ctx[7]}}function we(s,e,n){const o=s.slice();return o[8]=e[n],o[9]=e,o[10]=n,o}function Ce(s,e,n){const o=s.slice();return o[8]=e[n],o[11]=e,o[12]=n,o}function ke(s){let e,n=s[10],o=s[12],t;const i=()=>s[6](e,n,o),r=()=>s[6](null,n,o);let c={squareData:{isBlack:s[3](s[10],s[12]),column:s[12],row:s[10]},squareSize:s[0]};return e=new pt({props:c}),i(),e.$on("square-click",s[7]),{c(){N(e.$$.fragment)},m(l,a){M(e,l,a),t=!0},p(l,a){(n!==l[10]||o!==l[12])&&(r(),n=l[10],o=l[12],i());const m={};a&1&&(m.squareSize=l[0]),e.$set(m)},i(l){t||(q(e.$$.fragment,l),t=!0)},o(l){B(e.$$.fragment,l),t=!1},d(l){r(),R(e,l)}}}function ve(s){let e,n,o,t=Array(s[2].boardData.columns),i=[];for(let c=0;c<t.length;c+=1)i[c]=ke(Ce(s,t,c));const r=c=>B(i[c],1,1,()=>{i[c]=null});return{c(){e=v("div");for(let c=0;c<i.length;c+=1)i[c].c();n=A(),P(e,"class","row svelte-1q7kgo4")},m(c,l){b(c,e,l);for(let a=0;a<i.length;a+=1)i[a].m(e,null);C(e,n),o=!0},p(c,l){if(l&15){t=Array(c[2].boardData.columns);let a;for(a=0;a<t.length;a+=1){const m=Ce(c,t,a);i[a]?(i[a].p(m,l),q(i[a],1)):(i[a]=ke(m),i[a].c(),q(i[a],1),i[a].m(e,n))}for(Y(),a=t.length;a<i.length;a+=1)r(a);J()}},i(c){if(!o){for(let l=0;l<t.length;l+=1)q(i[l]);o=!0}},o(c){i=i.filter(Boolean);for(let l=0;l<i.length;l+=1)B(i[l]);o=!1},d(c){c&&w(e),oe(i,c)}}}function mt(s){let e,n,o=Array(s[2].boardData.rows),t=[];for(let r=0;r<o.length;r+=1)t[r]=ve(we(s,o,r));const i=r=>B(t[r],1,1,()=>{t[r]=null});return{c(){e=v("div");for(let r=0;r<t.length;r+=1)t[r].c();P(e,"class","board svelte-1q7kgo4")},m(r,c){b(r,e,c);for(let l=0;l<t.length;l+=1)t[l].m(e,null);n=!0},p(r,[c]){if(c&15){o=Array(r[2].boardData.rows);let l;for(l=0;l<o.length;l+=1){const a=we(r,o,l);t[l]?(t[l].p(a,c),q(t[l],1)):(t[l]=ve(a),t[l].c(),q(t[l],1),t[l].m(e,null))}for(Y(),l=o.length;l<t.length;l+=1)i(l);J()}},i(r){if(!n){for(let c=0;c<o.length;c+=1)q(t[c]);n=!0}},o(r){t=t.filter(Boolean);for(let c=0;c<t.length;c+=1)B(t[c]);n=!1},d(r){r&&w(e),oe(t,r)}}}function gt(s,e,n){let o;G(s,Q,f=>n(2,o=f));let{squareSize:t=5}=e;const i=_e(o.boardData.rows,o.boardData.columns),r=f=>{for(const _ of f)i[_.row][_.column].setHighlight(!0)},c=()=>{ge(i,(f,_,g)=>{f.setHighlight(!1)})},l=(f,_)=>f%2?!(_%2):!!(_%2);function a(f,_,g){X[f?"unshift":"push"](()=>{i[_][g]=f,n(1,i)})}function m(f){We.call(this,s,f)}return s.$$set=f=>{"squareSize"in f&&n(0,t=f.squareSize)},[t,i,o,l,r,c,a,m]}class _t extends O{constructor(e){super();$(this,e,gt,mt,z,{squareSize:0,highlightSquares:4,clearHighlights:5})}get highlightSquares(){return this.$$.ctx[4]}get clearHighlights(){return this.$$.ctx[5]}}function bt(s){let e,n;return{c(){e=v("p"),n=E(s[0])},m(o,t){b(o,e,t),C(e,n)},p(o,[t]){t&1&&x(n,o[0])},i:I,o:I,d(o){o&&w(e)}}}function wt(s,e,n){let o,t;return G(s,Q,i=>n(1,t=i)),s.$$.update=()=>{s.$$.dirty&2&&n(0,o=(()=>{if(t.winner===D.White)return"White won! \u{1F389}";if(t.winner===D.Black)return"Black won! \u{1F389}";let i="";return t.turn.color===D.White?i+="White is ":t.turn.color===D.Black&&(i+="Black is "),t.turn.action===F.Card?i+="placing a card...":t.turn.action===F.Piece&&(i+="moving a piece..."),i})())},[o,t]}class Ct extends O{constructor(e){super();$(this,e,wt,bt,z,{})}}class kt{constructor(){y(this,"isSet",!1);y(this,"position");y(this,"validMoves",[])}set(e,n){this.isSet=!0,this.position=e,this.validMoves=le(n,e)}unset(){this.isSet=!1,this.position=void 0,this.validMoves=[]}}function vt(s){let e,n,o,t,i,r,c,l,a,m={squareSize:3};return t=new _t({props:m}),s[3](t),t.$on("square-click",s[1]),r=new Ct({}),{c(){e=v("button"),e.textContent="New Game",n=A(),o=v("div"),N(t.$$.fragment),i=A(),N(r.$$.fragment),P(o,"class","board-container svelte-1gttu0h")},m(f,_){b(f,e,_),b(f,n,_),b(f,o,_),M(t,o,null),b(f,i,_),M(r,f,_),c=!0,l||(a=V(e,"click",s[2]),l=!0)},p(f,[_]){const g={};t.$set(g)},i(f){c||(q(t.$$.fragment,f),q(r.$$.fragment,f),c=!0)},o(f){B(t.$$.fragment,f),B(r.$$.fragment,f),c=!1},d(f){f&&w(e),f&&w(n),f&&w(o),s[3](null),R(t),f&&w(i),R(r,f),l=!1,a()}}}function yt(s,e,n){let o,t,i;G(s,H,d=>n(4,o=d)),G(s,Q,d=>n(5,t=d)),G(s,ee,d=>n(6,i=d));let r;const c=new kt,l=()=>{t.winner!==null&&H.update(d=>(t.winner===d.myColor?d.setWinner(K.Me):d.setWinner(K.Them),d))},a=()=>{Q.update(d=>(d.nextTurn(),d)),o.connected&&i.connectionClient.send({type:"game",data:t.get()},o.connectionId),l()};i.openTriggers.push(()=>{i.connectionClient.recievers.push((d,u)=>{u===o.connectionId&&((d==null?void 0:d.type)==="game"?(Q.update(h=>(h.set(d.data),h)),l()):(d==null?void 0:d.type)==="gameReset"&&H.update(h=>(h.requestNewGame(K.Them)&&h.swapColors(),h)))})});const m=d=>{c.set(d,t.boardData),r.highlightSquares(c.validMoves)},f=()=>{c.unset(),r.clearHighlights()},_=d=>{if(t.winner!==null||o.connected&&o.myColor!==t.turn.color)return;const{position:u,squareType:h}=d.detail;switch(h){case T.Empty:t.turn.action===F.Card&&(t.boardData.setSquareType(u,T.Card),a()),t.turn.action===F.Piece&&c.isSet&&(ze(u,c.validMoves)&&(t.boardData.movePiece(c.position,u),a()),f());break;case T.Card:c.isSet&&f();break;case T.WhitePiece:if(c.isSet&&re.isEqual(c.position,u)){f();break}f(),t.turn.action===F.Piece&&t.turn.color===D.White&&m(u);break;case T.BlackPiece:if(c.isSet&&re.isEqual(c.position,u)){f();break}f(),t.turn.action===F.Piece&&t.turn.color===D.Black&&m(u);break}},g=()=>{if(o.connected){let d;H.update(u=>(d=u.requestNewGame(K.Me),u)),i.connectionClient.send({type:"gameReset",data:null},o.connectionId),d&&(Q.update(u=>(u.reset(),u)),i.connectionClient.send({type:"game",data:t.get()},o.connectionId),H.update(u=>(u.swapColors(),u)))}else Q.update(d=>(d.reset(),d))};function p(d){X[d?"unshift":"push"](()=>{r=d,n(0,r)})}return[r,_,g,p]}class qt extends O{constructor(e){super();$(this,e,yt,vt,z,{})}}function te(s,...e){if(s.length-1!==e.length)throw"Invalid template literal!";const n=[];for(let o=0;o<e.length;o++){const t=s[o].trim();n.push({color:t,text:e[o]})}return{parts:n}}class St{constructor(e){y(this,"capacity");y(this,"lines");this.capacity=e,this.lines=[]}set(...e){this.lines=e.slice(-this.capacity)}append(...e){this.lines.push(...e),this.lines=this.lines.slice(-this.capacity)}clear(){this.lines=[]}}function Tt(s){let e,n=s[0].text+"",o;return{c(){e=v("span"),o=E(n),ne(e,"--text-color",s[0].color),P(e,"class","coloredText svelte-1ezy0zi")},m(t,i){b(t,e,i),C(e,o)},p(t,[i]){i&1&&n!==(n=t[0].text+"")&&x(o,n),i&1&&ne(e,"--text-color",t[0].color)},i:I,o:I,d(t){t&&w(e)}}}function Bt(s,e,n){let{coloredString:o}=e;return s.$$set=t=>{"coloredString"in t&&n(0,o=t.coloredString)},[o]}class It extends O{constructor(e){super();$(this,e,Bt,Tt,z,{coloredString:0})}}function ye(s,e,n){const o=s.slice();return o[1]=e[n],o}function qe(s){let e,n;return e=new It({props:{coloredString:s[1]}}),{c(){N(e.$$.fragment)},m(o,t){M(e,o,t),n=!0},p(o,t){const i={};t&1&&(i.coloredString=o[1]),e.$set(i)},i(o){n||(q(e.$$.fragment,o),n=!0)},o(o){B(e.$$.fragment,o),n=!1},d(o){R(e,o)}}}function Pt(s){let e,n,o=s[0].parts,t=[];for(let r=0;r<o.length;r+=1)t[r]=qe(ye(s,o,r));const i=r=>B(t[r],1,1,()=>{t[r]=null});return{c(){for(let r=0;r<t.length;r+=1)t[r].c();e=ie()},m(r,c){for(let l=0;l<t.length;l+=1)t[l].m(r,c);b(r,e,c),n=!0},p(r,[c]){if(c&1){o=r[0].parts;let l;for(l=0;l<o.length;l+=1){const a=ye(r,o,l);t[l]?(t[l].p(a,c),q(t[l],1)):(t[l]=qe(a),t[l].c(),q(t[l],1),t[l].m(e.parentNode,e))}for(Y(),l=o.length;l<t.length;l+=1)i(l);J()}},i(r){if(!n){for(let c=0;c<o.length;c+=1)q(t[c]);n=!0}},o(r){t=t.filter(Boolean);for(let c=0;c<t.length;c+=1)B(t[c]);n=!1},d(r){oe(t,r),r&&w(e)}}}function At(s,e,n){let{coloredText:o}=e;return s.$$set=t=>{"coloredText"in t&&n(0,o=t.coloredText)},[o]}class Et extends O{constructor(e){super();$(this,e,At,Pt,z,{coloredText:0})}}function Se(s,e,n){const o=s.slice();return o[14]=e[n],o}function Te(s){let e,n,o,t;return n=new Et({props:{coloredText:s[14]}}),{c(){e=v("div"),N(n.$$.fragment),o=A()},m(i,r){b(i,e,r),M(n,e,null),C(e,o),t=!0},p(i,r){const c={};r&2&&(c.coloredText=i[14]),n.$set(c)},i(i){t||(q(n.$$.fragment,i),t=!0)},o(i){B(n.$$.fragment,i),t=!1},d(i){i&&w(e),R(n)}}}function Dt(s){let e,n,o,t,i,r,c,l,a,m,f,_,g=s[1].lines,p=[];for(let u=0;u<g.length;u+=1)p[u]=Te(Se(s,g,u));const d=u=>B(p[u],1,1,()=>{p[u]=null});return{c(){e=v("div"),n=v("div");for(let u=0;u<p.length;u+=1)p[u].c();o=A(),t=v("div"),i=v("pre"),r=E(s[0]),c=A(),l=v("form"),a=v("input"),P(i,"class","prompt svelte-xyhhrb"),P(a,"class","chatInput svelte-xyhhrb"),P(a,"type","text"),P(l,"class","form"),P(t,"class","input svelte-xyhhrb"),P(e,"class","webConsole svelte-xyhhrb")},m(u,h){b(u,e,h),C(e,n);for(let S=0;S<p.length;S+=1)p[S].m(n,null);C(e,o),C(e,t),C(t,i),C(i,r),C(t,c),C(t,l),C(l,a),s[12](a),s[13](e),m=!0,f||(_=[V(l,"submit",me(s[4])),V(e,"click",me(s[5]))],f=!0)},p(u,[h]){if(h&2){g=u[1].lines;let S;for(S=0;S<g.length;S+=1){const j=Se(u,g,S);p[S]?(p[S].p(j,h),q(p[S],1)):(p[S]=Te(j),p[S].c(),q(p[S],1),p[S].m(n,null))}for(Y(),S=g.length;S<p.length;S+=1)d(S);J()}(!m||h&1)&&x(r,u[0])},i(u){if(!m){for(let h=0;h<g.length;h+=1)q(p[h]);m=!0}},o(u){p=p.filter(Boolean);for(let h=0;h<p.length;h+=1)B(p[h]);m=!1},d(u){u&&w(e),oe(p,u),s[12](null),s[13](null),f=!1,pe(_)}}}function Wt(s,e,n){let{promptString:o}=e,{maxLines:t}=e,{commandHandler:i}=e,{inputHandler:r}=e;const c=new St(t);let l,a;const m=(...h)=>{c.set(...h),n(1,c)},f=(...h)=>{c.append(...h),n(1,c)},_=()=>{c.clear(),n(1,c)},g=()=>{const h=a.value.replace(/(\r\n|\n|\r)/gm,"");if(n(3,a.value="",a),f(te`black${o} grey${h}`),h.charAt(0)==="/"){const[S,...j]=h.slice(1).split(" ");i(S,...j)}else r(h)},p=()=>{a.focus({preventScroll:!0})};He(()=>{n(2,l.scrollTop=l.scrollHeight,l)});function d(h){X[h?"unshift":"push"](()=>{a=h,n(3,a)})}function u(h){X[h?"unshift":"push"](()=>{l=h,n(2,l)})}return s.$$set=h=>{"promptString"in h&&n(0,o=h.promptString),"maxLines"in h&&n(6,t=h.maxLines),"commandHandler"in h&&n(7,i=h.commandHandler),"inputHandler"in h&&n(8,r=h.inputHandler)},[o,c,l,a,g,p,t,i,r,m,f,_,d,u]}class Ht extends O{constructor(e){super();$(this,e,Wt,Dt,z,{promptString:0,maxLines:6,commandHandler:7,inputHandler:8,set:9,append:10,clear:11})}get set(){return this.$$.ctx[9]}get append(){return this.$$.ctx[10]}get clear(){return this.$$.ctx[11]}}function Gt(s){let e,n,o,t,i,r,c,l,a;t=new ft({}),r=new qt({});let m={promptString:"-> ",maxLines:50,inputHandler:s[1],commandHandler:s[2]};return l=new Ht({props:m}),s[3](l),{c(){e=v("div"),n=v("h1"),n.textContent="Blackout",o=A(),N(t.$$.fragment),i=A(),N(r.$$.fragment),c=A(),N(l.$$.fragment),P(n,"class","svelte-1nt12ac"),P(e,"class","container svelte-1nt12ac")},m(f,_){b(f,e,_),C(e,n),C(e,o),M(t,e,null),C(e,i),M(r,e,null),C(e,c),M(l,e,null),a=!0},p(f,[_]){const g={};l.$set(g)},i(f){a||(q(t.$$.fragment,f),q(r.$$.fragment,f),q(l.$$.fragment,f),a=!0)},o(f){B(t.$$.fragment,f),B(r.$$.fragment,f),B(l.$$.fragment,f),a=!1},d(f){f&&w(e),R(t),R(r),s[3](null),R(l)}}}function Ot(s,e,n){let o,t;G(s,H,a=>n(4,o=a)),G(s,ee,a=>n(5,t=a));let i;Ge(()=>{i.set(te`blue${"Chat"}`),t.openTriggers.push(()=>{t.connectionClient.recievers.push((a,m)=>{m===o.connectionId&&((a==null?void 0:a.type)==="text"&&i.append(te`pink ${"<Opponent> "} black${a.data}`),(a==null?void 0:a.type)==="textInfo"&&i.append(te`blue${a.data}`))})}),window.onbeforeunload=()=>{o.connected&&t.connectionClient.send({type:"textInfo",data:"Opponent left."},o.connectionId),t.connectionClient.disconnectAll(),H.update(a=>(a.closeConnection(),a))}});const r=a=>{o.connected&&t.connectionClient.send({type:"text",data:a},o.connectionId)},c=(a,...m)=>{switch(a=a.toLowerCase(),a){case"":break;case"clear":case"clr":i.clear();break;default:i.append(te`red${a} black${": command not found!"}`)}};function l(a){X[a?"unshift":"push"](()=>{i=a,n(0,i)})}return[i,r,c,l]}class $t extends O{constructor(e){super();$(this,e,Ot,Gt,z,{})}}new $t({target:document.getElementById("app")});
